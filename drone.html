<head>
<style>
    #drone{
        background-color: blueviolet
    }
    svg{
        position: absolute
    }
</style>
<!-- development version, includes helpful console warnings -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
<div id="drone">
    <drone-info v-bind:object="this">
    </drone-info>
    <svg width="100" height="100"
    v-bind:style="{left:x, bottom: y}">
        <rect width="100" height="100" 
        style="background-color: red" />
    </svg>
</div>
<script>
    document.onkeydown = function(){
        appDrone.keyEvent(true);
    }
    document.onkeyup = function(){
        appDrone.keyEvent(false);
    }

    const ALMOST_60FPS = 16;

    const GRAVITY = 0.25;
    const SPEED_MIN = 0;
    const SPEED_MAX = 10;
    const ACCELERATION = 1;
    const STABILIZE_SPEED = 0.25;

    const ARRAY_CODE = {
        spacebar: 32,
        left: 37,
        up: 38,
        right: 39,
        down: 40
    }

    Vue.component('drone-info', {
        props: ['object'],
        template: '<div>x {{object.x}}<br />' + 
        'y {{object.y}}<br />' +
        'speedX {{object.speedX}}<br />' +
        'speedY {{object.speedY}}<br />' +
        '<span v-if="object.power">Power on</span></div>'
    });

    var appDrone = new Vue({
        el: '#drone',
        data: {
            power: true,
            x: 0,
            y: 0,
            speedX: 0,
            speedY: 0,
            left: false,
            up: false,
            right: false,
            down: false
        },
        methods: {
            stabilizeX: function(){
                if(this.speedX > SPEED_MIN){
                    this.setSpeedX(this.speedX - STABILIZE_SPEED);
                }else if(this.speedX < SPEED_MIN){
                    this.setSpeedX(this.speedX + STABILIZE_SPEED);
                }
            },
            stabilizeY: function(){
                if(this.speedY > SPEED_MIN){
                    this.setSpeedY(this.speedY - STABILIZE_SPEED);
                }else if(this.speedY < SPEED_MIN){
                    this.setSpeedY(this.speedY + STABILIZE_SPEED);
                }
            },
            updateX: function(){
                this.x += this.speedX;
                setTimeout(this.updateX, ALMOST_60FPS);
            },
            updateY: function(){
                this.y += this.speedY;
                setTimeout(this.updateY, ALMOST_60FPS);
            },
            updateSpeed: function(){
                if(this.left){
                    this.setSpeedX(this.speedX - ACCELERATION);
                }
                if(this.right){
                    this.setSpeedX(this.speedX + ACCELERATION);
                }
                if(this.up){
                    this.setSpeedY(this.speedY + ACCELERATION);
                }
                if(!this.power){
                    this.setSpeedY(this.speedY - GRAVITY);
                }else if(this.down){
                    this.setSpeedY(this.speedY - ACCELERATION);
                }

                if(this.isIdleX()){
                    this.stabilizeX();
                }
                if(this.isIdleY()){
                    this.stabilizeY();
                }

                setTimeout(this.updateSpeed, ALMOST_60FPS);
            },
            keyEvent: function(isKeyDown){
                var keyCode = event.keyCode;
                if(keyCode == ARRAY_CODE.spacebar){
                    if(isKeyDown){
                        this.power = !this.power;
                    }
                }

                if(!this.power){
                    this.left = false;
                    this.up = false;
                    this.right = false;
                    this.down = false;
                    return;
                }

                switch(keyCode){
                case ARRAY_CODE.left:
                    this.left = isKeyDown;
                    break;
                case ARRAY_CODE.up:
                    this.up = isKeyDown;
                    break;
                case ARRAY_CODE.right:
                    this.right = isKeyDown;
                    break;
                case ARRAY_CODE.down:
                    this.down = isKeyDown;
                }
            },
            setSpeedX: function(speed){
                if(speed < (-SPEED_MAX)){
                    this.speedX = -SPEED_MAX;
                }else if(speed > SPEED_MAX){
                    this.speedX = SPEED_MAX;
                }else{
                    this.speedX = speed;
                }
            },
            setSpeedY: function(speed){
                if(speed < (-SPEED_MAX)){
                    this.speedY = -SPEED_MAX;
                }else if(speed > SPEED_MAX){
                    this.speedY = SPEED_MAX;
                }else{
                    this.speedY = speed;
                }
            },
            isIdleX: function(){
                return (this.power) && 
                (!this.left) && (!this.right)
            },
            isIdleY: function(){
                return (this.power) && 
                (!this.up) &&(!this.down);
            }
        }
    });

    appDrone.updateX();
    appDrone.updateY();
    appDrone.updateSpeed();
</script>
</body>